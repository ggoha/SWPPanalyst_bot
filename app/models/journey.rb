class Journey
  PLACES = ['—Ç—Ä–∏–¥–µ—Å—è—Ç–æ–µ —Ü–∞—Ä—Å—Ç–≤–æ', '–ø–æ–¥–∑–µ–º–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥', '–ú–§–¢–ò', '–ú–æ–Ω–≥–æ–ª–∏—é', '–≤—Å–µ–ª–µ–Ω–Ω—É—é –†–∏–∫–∞ –∏ –ú–æ—Ä—Ç–∏', '–ø—Ä–æ—à–ª—ã–π –≥–æ–¥',
         '–≥–æ—Ä–æ–¥ –±–µ–∑ –¥–æ—Ä–æ–≥', '—á–µ–º–ø–∏–æ–Ω–∞—Ç –†–æ—Å—Å–∏–∏ –ø–æ —Ñ—É—Ç–±–æ–ª—É', '–ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã', '–û—Ä—Å–∫', '–ü–∏—Ä–æ–ª—è–Ω–¥–∏—é', '–ø—Ä–µ–∫—Ä–∞—Å–Ω–æ–µ –¥–∞–ª–µ–∫–æ', '–≥–æ—Ä–æ–¥ N-—Å–∫']
  CHARACTERS = ['–†–∏–∫–∞ –∏ –ú–æ—Ä—Ç–∏', '—Ä—É—Å–∞–ª–æ–∫', '–∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–∞ –ì–ê–ò', '–î–∂–µ–∫–∏ –ß–∞–Ω–∞', '–≥–ª–∞–¥–∏–æ–ª—É—Å', '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞ –°–µ—Ä–≥–µ–µ–≤–∏—á–∞', '–í–∏—Ç—å–∫–∞ –∏–∑ 2 –ø–æ–¥—ä–µ–∑–¥–∞',
          '–∫–æ—Ç–∞ –∏–∑ –ü—Ä–æ—Å—Ç–æ–∫–≤–∞—à–∏–Ω–æ', '–º–∞—Å—Ç–µ—Ä–∞ –ô–æ–¥—É', '—Ç—Ä–æ–π–Ω–æ–≥–æ –∏–Ω—Ç–µ–≥—Ä–∞–ª–∞', '–º–∏—Å—Å –í—Å–µ–ª–µ–Ω–Ω—É—é']
  ACTIONS = ['–≤—ã–ø–∏–ª–∏ –∑–∞ –ª—é–±–æ–≤—å', '–ø–æ–¥–Ω—è–ª–∏ –∑–≤–µ–∑–¥–æ–ª–µ—Ç –∏–∑ –±–æ–ª–æ—Ç–∞', '–ø—Ä–æ—à–ª–∏—Å—å –ø–æ —Ü–µ–ø–∏ –≤ –¥—Ä—É–≥—É—é —Å—Ç–æ—Ä–æ–Ω—É', '—Å–æ–≥–Ω—É–ª–∏—Å—å 12 —Ä–∞–∑', '—Å—Ä–∞–∑–∏–ª–∏—Å—å –Ω–∞ –¥—É—ç–ª–∏',
          '–≤–µ—Ä–Ω—É–ª–∏—Å—å –≤ 2007', '–ø–æ—Å—Ç—Ä–æ–∏–ª–∏ –†–∏–º', '–Ω–∞–∫–∞—Ç–∏–ª–∏ FreeBSD', '–ø–æ–≥–ª–∞–¥–∏–ª–∏ –±–µ–ª—å–µ', '—Ä–µ—à–∏–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å', '–æ—Ç–º–µ—Ç–∏—Ç—å –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è –¥–≤–æ—é—Ä–æ–¥–Ω–æ–π —Å–µ—Å—Ç—Ä—ã –ø–æ –º–∞—Ç–µ—Ä–∏–Ω—Å–∫–æ–π –ª–∏–Ω–∏–∏ —Ç–µ—Å—Ç—è –∑–Ω–∞–∫–æ–º–æ–≥–æ', '—Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è "–ö–æ–º—É –Ω–∞ –†—É—Å–∏ –∂–∏—Ç—å —Ö–æ—Ä–æ—à–æ?"']
  CAMBAKS = ['—Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–Ω—ã–π –≤–µ—Ä–Ω—É–ª—Å—è –¥–æ–º–æ–π', '—Ä–µ—à–∏–ª –±–æ–ª—å—à–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–∏—Ç—å', '–Ω–∞–ø–∏c–∞–ª —Å–≤–æ—é —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é —Ç–µ–∫—Å—Ç–æ–≤—É—é –∏–≥—Ä—É', '–∑–∞—é–∑–∞–ª —Ñ–∞—Å—Ç-—Ç—Ä–µ–≤–µ–ª', 
          '–≤–∑—è–ª —Ç–∞–∫—Å–∏ –¥–æ –¥–æ–º–∞', '—Ä–µ—à–∏–ª –¥–æ–º–æ–π –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—åc—è', '–ø–µ—Ä–µ–∫–∞—Ç–∞–º–∏ –¥–æ–±—Ä–∞–ª—Å—è –¥–æ –±–ª–∏–∂–∞–π—à–µ–π –¥–µ—Ä–µ–≤–Ω–∏',
          '–¥–∞–ª –æ–±–µ—Ç –º–æ–ª—á–∞–Ω–∏—è –∏ –ø–æ—à–µ–ª —Å–≤–æ–µ–π –¥–æ—Ä–æ–≥–æ–π', '–±—ã–ª –¥–æ—Å—Ç–∞–≤–ª–µ–Ω –≤ –±–ª–∏–∂–∞–π—à—É—é —Ç—é—Ä—å–º—É', '—É–ª–µ—Ç–µ–ª –Ω–∞ —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–π —Ç—è–≥–µ', '—Ä–µ—à–∏–ª —á—Ç–æ –Ω—É–∂–Ω–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å', '–∑–∞—Ä–µ–∫—Å—è –Ω–∏–∫–æ–≥–¥–∞ —Ç–∞–∫ –Ω–µ –¥–µ–ª–∞—Ç—å']
  
  def self.start(user)
    if user.halloween_status == 'inactive' ||  user.halloween_status == 'active' || user.halloween_status == 'win'
      if user.star_journey_at.nil? || user.star_journey_at < DateTime.now-11.hour
        user.update_attributes(halloween_status: 'walk', star_journey_at: DateTime.now)
	user.add_achivment(Achivment.find(16)) unless user.achivments.include?(Achivment.find(16))
        '–¢—ã —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏–ª—Å—è –≤ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ'
      else
        '–¢—ã –Ω–µ —Å–º–æ–≥ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è –≤ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ –µ—â–µ —Å–ª–∏—à–∫–æ–º —É—Å—Ç–∞–ª –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è –≤ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –º–æ–∂–Ω–æ —Ä–∞–∑ 12 —á–∞—Å–æ–≤'
      end
    else
       case user.halloween_status
       when 'death' 
         '–¢–≤–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å –Ω–µ—É–¥–∞—á–Ω–æ, –ø–æ–¥–æ–∂–¥–∏ –ø–æ–∫–∞ –∫—Ç–æ-–Ω–∏–±—É–¥—å –∑–∞–π–º–µ—Ç—Å—è –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∏–µ–π'
       when 'walk' 
         '–¢—ã —É–∂–µ –≤ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–∏'
       end
    end
  end

  def self.event(user)
    r  = rand(100)
    if r < 2
      return win(user)
    end
    if r < 5
      return death(user)
    end
    if r < 10
      return necromancy(user)
    end
    if r < 33
      return end_walk(user)
    end
    return walk(user)
  end

  def self.necromancy(user)
    target = User.where(halloween_status: 'death').order("RANDOM()").first
    if target
      target.update_attributes(halloween_status: 'active')
      bot = Telegram.bots[:division]
      bot.send_message chat_id: target.telegram_id, text: '–¢–µ–±—è –≤–æ—Å–∫—Ä–µ—Å–∏–ª –º–∏–º–æ–ø—Ä–æ—Ö–æ–¥—è—â–∏–π –ø—É—Ç–Ω–∏–∫'
      '–¢—ã —É—Å–ø–µ—à–Ω–æ –ø–æ–ø—Ä–∞–∫—Ç–∏–∫–æ–≤–∞–ª—Å—è –≤ –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∏–∏ –∏ –ø–æ–¥–Ω—è–ª –∫–∞–∫–æ–≥–æ-—Ç–æ –Ω–µ–∑–∞–¥–∞—á–ª–∏–≤–æ–≥–æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞'
    else
      '–¢–≤–æ–∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã –≤ –Ω–µ–∫—Ä–æ–º–∞–Ω—Ç–∏–∏ –Ω–µ —É–≤–µ–Ω—á–∞–ª–∏—Å—å —É—Å–ø–µ—Ö–æ–º'
    end
  end

  def self.end_walk(user)
    user.update_attributes(halloween_status: 'active')
    message = '–¢—ã –ø–µ—Ä–µ–¥—É–º–∞–ª –∏–¥—Ç–∏ –¥–∞–ª—å—à–µ –Ω–∞ —ç—Ç–æ–º —Ç–≤–æ–µ –ø—É—Ç–µ—à–µ—Ç–≤–∏–µ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å'
  end

  def self.win(user)
    user.update_attributes(halloween_status: 'win')
    message = 'üéâ–¢—ã –ø–æ–±–µ–¥–∏–ª –º–æ–Ω—Å—Ç—Ä–∞ –≤ –Ω–µ—Ä–∞–≤–Ω–æ–º –±–æ—é. –¢–≤–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –æ–∫–æ–Ω–µ–Ω–æ, –Ω–æ –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ —Ç—ã –º–æ–∂–µ—à—å –Ω–∞—á–∞—Ç—å –Ω–æ–≤–æ–µ.üéâ'
  end

  def self.death(user)
    user.update_attributes(halloween_status: 'death')
    message = 'üòµ–¢—ã –Ω–∞—à–µ–ª –º–æ–Ω—Å—Ç—Ä–∞. –ù–æ –ª—É—á—à–µ –±—ã —Ç—ã –µ–≥–æ –Ω–µ –Ω–∞—Ö–æ–¥–∏–ª. –î–ª—è —Ç–µ–±—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –∑–∞–∫–æ–Ω—á–µ–Ω–æ. –ù–æ –≤–æ–∑–º–æ–∂–Ω–æ —Ç–µ–±–µ –ø–æ–º–æ–≥—É—Çüòµ'
  end

  def self.walk(user)
    message = "–¢–≤–æ–π –ø–µ—Ä—Å–æ–Ω–∞–∂ –¥–æ–ª–≥–æ —à–µ–ª –∏ –Ω–∞–∫–æ–Ω–µ—Ü –ø—Ä–∏—à–µ–ª –≤ #{PLACES.sample}," \
    " —Ç–∞–º —Ç—ã –≤—Å—Ç—Ä–µ—Ç–∏–ª #{CHARACTERS.sample}," \
    " –≤–º–µ—Å—Ç–µ –≤—ã #{ACTIONS.sample}," \
    " –ø–æ—Å–ª–µ —á–µ–≥–æ —Ç—ã #{CAMBAKS.sample}."
  end
end
